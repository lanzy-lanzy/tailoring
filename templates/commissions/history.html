{% extends 'base.html' %}

{% block title %}Commission Audit - El Senior Original Tailoring{% endblock %}

{% block page_title %}Commission Audit Logs{% endblock %}

{% block content %}
<div class="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
    <!-- Filters & Stats Header -->
    <div class="bg-slate-900 rounded-[2rem] p-8 shadow-2xl border border-white/10 relative overflow-hidden group">
        <div class="absolute inset-0 bg-gradient-to-br from-emerald-600/10 via-transparent to-teal-500/5"></div>
        <div class="relative flex flex-col lg:flex-row lg:items-center justify-between gap-8">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <h2 class="text-3xl font-black text-white tracking-tight">Financial Audit</h2>
                    <span class="px-3 py-1 bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-[10px] font-black uppercase tracking-widest rounded-full">
                        {{ total_count }} Entries Detected
                    </span>
                </div>
                <div class="flex items-baseline">
                    <span class="text-xs font-black text-emerald-500/50 mr-1 uppercase">Cumulative Value</span>
                    <span class="text-2xl font-black text-white tracking-tighter">PHP {{ total_amount|floatformat:2 }}</span>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <a href="{% url 'commission_dashboard' %}" 
                   class="inline-flex items-center px-6 py-3.5 bg-white/5 text-slate-300 font-black uppercase tracking-widest text-[10px] rounded-2xl border border-white/10 hover:bg-white/10 hover:text-white transition-all group/back">
                    <svg class="w-4 h-4 mr-2 transform group-hover/back:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Return to Hub
                </a>
            </div>
        </div>

        <!-- Refined Filter Bar -->
        <div class="relative mt-8 pt-8 border-t border-white/5">
            <form method="get" class="flex flex-wrap items-end gap-4">
                <div class="min-w-[160px]">
                    <label class="block text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-1.5 ml-1">Status Protocol</label>
                    <select name="status" class="w-full bg-slate-800/50 border border-slate-700 text-slate-100 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-emerald-500 outline-none appearance-none cursor-pointer">
                        <option value="">All Transactions</option>
                        <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending Reserve</option>
                        <option value="credited" {% if status_filter == 'credited' %}selected{% endif %}>Active Credit</option>
                        <option value="paid" {% if status_filter == 'paid' %}selected{% endif %}>Finalized Payout</option>
                    </select>
                </div>
                
                <div class="min-w-[160px]">
                    <label class="block text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-1.5 ml-1">From Temporal</label>
                    <input type="date" name="date_from" value="{{ date_from|date:'Y-m-d' }}"
                           class="w-full bg-slate-800/50 border border-slate-700 text-slate-100 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                
                <div class="min-w-[160px]">
                    <label class="block text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-1.5 ml-1">To Temporal</label>
                    <input type="date" name="date_to" value="{{ date_to|date:'Y-m-d' }}"
                           class="w-full bg-slate-800/50 border border-slate-700 text-slate-100 rounded-xl px-4 py-2.5 focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                
                <div class="flex items-center gap-2">
                    <button type="submit" class="px-6 py-2.5 bg-emerald-500 text-white font-black uppercase tracking-widest text-[10px] rounded-xl hover:bg-emerald-400 transition-all shadow-lg shadow-emerald-500/20">
                        Filter Audit
                    </button>
                    <a href="{% url 'commission_history' %}" class="px-4 py-2.5 bg-slate-800 text-slate-400 font-black uppercase tracking-widest text-[10px] rounded-xl hover:bg-slate-700 transition-all">
                        Reset
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Audit Ledger -->
    <div class="bg-white rounded-[2rem] shadow-xl border border-emerald-100 overflow-hidden">
        {% if commissions %}
        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-emerald-50/50">
                        <th class="px-8 py-6 text-[10px] font-black text-emerald-700 uppercase tracking-widest">Descriptor</th>
                        <th class="px-8 py-6 text-[10px] font-black text-emerald-700 uppercase tracking-widest">Temporal Point</th>
                        {% if user.profile.is_admin %}
                        <th class="px-8 py-6 text-[10px] font-black text-emerald-700 uppercase tracking-widest">Master Talent</th>
                        {% endif %}
                        <th class="px-8 py-6 text-[10px] font-black text-emerald-700 uppercase tracking-widest">Order / Line</th>
                        <th class="px-8 py-6 text-[10px] font-black text-emerald-700 uppercase tracking-widest text-right">Yield</th>
                        <th class="px-8 py-6 text-[10px] font-black text-emerald-700 uppercase tracking-widest text-center">Protocol Status</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-emerald-50">
                    {% for c in commissions %}
                    <tr class="group hover:bg-emerald-50/30 transition-all duration-300">
                        <td class="px-8 py-6">
                            <span class="text-sm font-black text-slate-800 tracking-tight group-hover:text-emerald-600 transition-colors">#{{ c.commission_number }}</span>
                        </td>
                        <td class="px-8 py-6">
                            <p class="text-sm font-bold text-slate-700 leading-none">{{ c.earned_date|date:"d M Y" }}</p>
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">{{ c.earned_date|time:"g:i A" }}</p>
                        </td>
                        {% if user.profile.is_admin %}
                        <td class="px-8 py-6">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center text-emerald-400 text-[10px] font-black">
                                    {{ c.tailor.get_full_name|default:c.tailor.username|slice:":1"|upper }}
                                </div>
                                <span class="text-sm font-bold text-slate-700 tracking-tight">{{ c.tailor.get_full_name|default:c.tailor.username }}</span>
                            </div>
                        </td>
                        {% endif %}
                        <td class="px-8 py-6">
                            <div class="flex flex-col">
                                {% if c.order %}
                                <a href="{% url 'order_detail' c.order.pk %}" class="text-sm font-black text-slate-800 hover:text-emerald-600 transition-colors tracking-tight">
                                    {{ c.order.order_number }}
                                </a>
                                {% else %}
                                <span class="text-xs text-slate-400 font-bold italic">N/A</span>
                                {% endif %}
                                <span class="text-[10px] text-slate-500 font-black uppercase tracking-widest mt-0.5">{{ c.garment_type }}</span>
                            </div>
                        </td>
                        <td class="px-8 py-6 text-right">
                            <div class="flex flex-col items-end">
                                <span class="text-lg font-black text-emerald-600 tracking-tighter shadow-emerald-500/10 group-hover:scale-110 transition-transform">PHP {{ c.commission_amount|floatformat:2 }}</span>
                                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-0.5">{{ c.commission_rate }}% Rate</span>
                            </div>
                        </td>
                        <td class="px-8 py-6 text-center">
                            {% if c.status == 'pending' %}
                            <span class="inline-flex items-center px-4 py-1.5 bg-amber-50 text-amber-600 rounded-lg text-[9px] font-black uppercase tracking-[0.2em] border border-amber-100">
                                <span class="w-1 h-1 bg-amber-500 rounded-full mr-2"></span>
                                Reserved
                            </span>
                            {% elif c.status == 'credited' %}
                            <span class="inline-flex items-center px-4 py-1.5 bg-emerald-50 text-emerald-600 rounded-lg text-[9px] font-black uppercase tracking-[0.2em] border border-emerald-100">
                                <span class="w-1 h-1 bg-emerald-500 rounded-full mr-2 animate-pulse"></span>
                                Credited
                            </span>
                            {% elif c.status == 'paid' %}
                            <span class="inline-flex items-center px-4 py-1.5 bg-slate-900 text-emerald-400 rounded-lg text-[9px] font-black uppercase tracking-[0.2em] shadow-lg shadow-slate-900/10">
                                <span class="w-1 h-1 bg-emerald-400 rounded-full mr-2"></span>
                                Finalized
                            </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Modern Pagination -->
        {% if commissions.has_other_pages %}
        <div class="px-8 py-6 border-t border-emerald-50 bg-emerald-50/20 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest">
                Displaying Segment {{ commissions.start_index }} â€” {{ commissions.end_index }} of {{ commissions.paginator.count }} Recorded Yields
            </div>
            <div class="flex gap-2">
                {% if commissions.has_previous %}
                <a href="?page={{ commissions.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if date_from %}&date_from={{ date_from|date:'Y-m-d' }}{% endif %}{% if date_to %}&date_to={{ date_to|date:'Y-m-d' }}{% endif %}" 
                   class="p-2 bg-white border border-emerald-100 rounded-xl text-emerald-600 hover:bg-emerald-500 hover:text-white transition-all shadow-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                {% endif %}
                
                <span class="px-5 py-2 bg-slate-900 text-emerald-400 text-xs font-black rounded-xl shadow-lg shadow-slate-900/10">{{ commissions.number }}</span>
                
                {% if commissions.has_next %}
                <a href="?page={{ commissions.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if date_from %}&date_from={{ date_from|date:'Y-m-d' }}{% endif %}{% if date_to %}&date_to={{ date_to|date:'Y-m-d' }}{% endif %}" 
                   class="p-2 bg-white border border-emerald-100 rounded-xl text-emerald-600 hover:bg-emerald-500 hover:text-white transition-all shadow-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        {% else %}
        <div class="px-8 py-24 text-center">
            <div class="w-20 h-20 bg-slate-50 rounded-3xl flex items-center justify-center text-slate-200 mx-auto mb-6">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <h3 class="text-2xl font-black text-slate-800 tracking-tight">No Temporal Data</h3>
            <p class="text-slate-500 mt-2 font-medium">Try adjusting your filters or expanding your time frame.</p>
            <a href="{% url 'commission_history' %}" class="mt-8 inline-block px-8 py-3 bg-emerald-500 text-white font-black uppercase tracking-widest text-xs rounded-2xl hover:bg-emerald-400 transition-all shadow-lg shadow-emerald-500/20">
                Refresh Ledger
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

